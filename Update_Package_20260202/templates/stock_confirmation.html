{% extends 'base.html' %}

{% block content %}
<div class="service-container">
    <div class="header-section">
        <h1>Confirmação de Recebimento</h1>
        <p>Confirme o recebimento dos materiais entregues pelo Almoxarifado.</p>
    </div>

    <div style="margin-bottom: 20px;">
        <a href="{{ url_for('index') }}" class="action-btn" style="background-color: #95a5a6; text-decoration: none;">← Voltar</a>
    </div>

    {% if requests %}
        {% for req in requests %}
        <div class="request-card" style="background: white; border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; border-radius: 8px; border-left: 5px solid #f39c12;">
            <div class="req-header" style="display: flex; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                <div>
                    <strong>Entrega Realizada por:</strong> {{ req.fulfilled_by }}<br>
                    <small>Data Entrega: {{ req.fulfillment_date }}</small>
                </div>
                <div style="text-align: right;">
                    <strong>ID:</strong> {{ req.id }}
                </div>
            </div>

            <div class="items-review" style="margin-bottom: 15px;">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                            <th>Item</th>
                            <th>Qtd. Solicitada</th>
                            <th>Qtd. Recebida</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if req.items_structured %}
                            {% for item in req.items_structured %}
                            <tr>
                                <td>{{ item.name }}</td>
                                <td>{{ item.qty }}</td>
                                <td style="font-weight: bold;">{{ item.delivered_qty }}</td>
                                <td>
                                    {% if item.delivered_qty|float < item.qty|float %}
                                        <span style="color: #e67e22;">Parcial</span>
                                    {% else %}
                                        <span style="color: #27ae60;">Completo</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="4">{{ req.items }}</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>

            <form action="{{ url_for('stock_confirmation') }}" method="POST">
                <input type="hidden" name="req_id" value="{{ req.id }}">
                <div class="form-actions">
                    <button type="submit" class="action-btn" style="background-color: #27ae60;">Confirmar Recebimento</button>
                </div>
            </form>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <p>Não há entregas aguardando confirmação.</p>
            <a href="/" class="action-btn">Voltar ao Menu</a>
        </div>
    {% endif %}
</div>
{% endblock %}