{% extends 'base.html' %}

{% block title %}{{ service.name }} - Back of the House{% endblock %}

{% block content %}
<div class="service-page">
    <div class="service-header">
        <span class="service-icon"><i class="{{ service.icon }}"></i></span>
        <h2>{{ service.name }}</h2>
    </div>

    <div style="margin-bottom: 20px;">
        <a href="{{ url_for('index') }}" class="action-btn" style="background-color: #6c757d; text-decoration: none;"><i class="bi bi-arrow-left"></i> Voltar</a>
    </div>
    
    <div class="service-content">
        {% if purchase_alerts %}
        <div style="background-color: #fff3cd; color: #856404; padding: 15px; border-radius: 8px; border: 1px solid #ffeeba; margin-bottom: 20px;">
            <h3 style="margin-top: 0; display: flex; align-items: center; gap: 10px;">
                <i class="bi bi-exclamation-triangle-fill"></i> Alerta de Reposição
            </h3>
            <p>Os seguintes produtos estão sem compra há mais tempo que a frequência estipulada:</p>
            <ul style="margin-bottom: 0;">
                {% for alert in purchase_alerts %}
                <li style="margin-bottom: 5px;">
                    <strong>{{ alert.product }}</strong> 
                    ({{ alert.frequency }}) - 
                    Última compra: {{ alert.last_date }} 
                    <span style="color: #c0392b; font-weight: bold;">({{ alert.days }})</span>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <p>Bem-vindo à área de <strong>{{ service.name }}</strong>.</p>
        <p>Aqui você poderá realizar as tarefas relacionadas a este setor.</p>
        
        <!-- Monitoramento -->
        <div class="management-actions" style="margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px;">
            <h3><i class="bi bi-activity"></i> Monitoramento</h3>
            <div class="action-buttons">
                 <a href="{{ url_for('service_log', service_id=service.id) }}" class="action-btn"><i class="bi bi-clipboard-data"></i> Log de Ações</a>
            </div>
        </div>
        
        <!-- Operações de Consumo (Solicitação e Recebimento) -->
        {% if service.id == 'principal' %}
        <div class="consumption-actions" style="margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px;">
            <h3><i class="bi bi-box-seam"></i> Operações de Consumo</h3>
            <div class="action-buttons">
                <a href="{{ url_for('new_stock_request') }}" class="action-btn"><i class="bi bi-box-arrow-up"></i> Solicitar Material</a>
                
                {% if session.get('role') in ['gerente', 'admin'] %}
                <a href="{{ url_for('stock_confirmation') }}" class="action-btn"><i class="bi bi-check-circle"></i> Confirmar Recebimento</a>
                <a href="{{ url_for('stock_fulfillment') }}" class="action-btn"><i class="bi bi-box-arrow-right"></i> Separação de Pedidos</a>
                {% endif %}
            </div>
        </div>
        
        {% if is_manager %}
        <div class="management-actions" style="margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px;">
            <h3><i class="bi bi-cart"></i> Compras e Entradas</h3>
            <div class="action-buttons">
                 <a href="{{ url_for('stock_order') }}" class="action-btn"><i class="bi bi-list-check"></i> Gerar Lista de Compras</a>
                 <a href="{{ url_for('stock_entry') }}" class="action-btn"><i class="bi bi-box-arrow-in-down"></i> Entrada de Mercadoria</a>
            </div>
        </div>

        <div class="management-actions" style="margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px;">
            <h3><i class="bi bi-graph-up"></i> Gestão e Relatórios</h3>
            <div class="action-buttons">
                <a href="{{ url_for('stock_products') }}" class="action-btn"><i class="bi bi-boxes"></i> Gerenciar Insumos</a>
                <a href="{{ url_for('stock_adjust_min_levels') }}" class="action-btn"><i class="bi bi-sliders"></i> Revisar Estoque Mínimo</a>
                <a href="{{ url_for('stock_categories') }}" class="action-btn"><i class="bi bi-tags"></i> Categorias de Insumos</a>
            </div>
        </div>

        {% endif %}
        {% endif %}

        {% if service.id == 'restaurante_mirapraia' %}
        <div class="management-actions" style="margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px;">
            <h3><i class="bi bi-shop"></i> Operação</h3>
            <div class="action-buttons">
                <a href="{{ url_for('restaurant_tables') }}" class="action-btn"><i class="bi bi-grid-3x3"></i> Mesas & Pedidos</a>
                <a href="{{ url_for('client_menu') }}" class="action-btn" target="_blank"><i class="bi bi-phone"></i> Visualizar Cardápio Virtual</a>
                <a href="{{ url_for('restaurant.public_waiting_list') }}" class="action-btn" target="_blank"><i class="bi bi-people"></i> Fila de Espera</a>
            </div>
        </div>

        {% if is_manager or session.get('role') == 'admin' or session.get('role') == 'recepcao' %}
        <div class="management-actions" style="margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px;">
            <h3><i class="bi bi-book"></i> Gestão do Menu</h3>
            <div class="action-buttons">
                <a href="{{ url_for('menu_management') }}" class="action-btn"><i class="bi bi-journal-text"></i> Gerenciar Cardápio</a>
            </div>
        </div>
        {% endif %}
        {% endif %}

        {% if service.id == 'governanca' %}
        <div class="management-actions" style="margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px;">
            <h3><i class="bi bi-house-door"></i> Gestão de Quartos & Lavanderia</h3>
            <div class="action-buttons">
                <a href="{{ url_for('governance.governance_rooms') }}" class="action-btn"><i class="bi bi-door-closed"></i> Controle de Quartos</a>
                <a href="{{ url_for('governance.laundry_management') }}" class="action-btn"><i class="bi bi-basket"></i> Acessar Lavanderia</a>
                <a href="{{ url_for('maintenance.new_maintenance_request') }}" class="action-btn"><i class="bi bi-tools"></i> Solicitar Manutenção</a>
            </div>
        </div>
        <div class="consumption-actions" style="margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px;">
            <h3><i class="bi bi-box-seam"></i> Material</h3>
            <div class="action-buttons">
                <a href="{{ url_for('new_stock_request') }}" class="action-btn"><i class="bi bi-box-arrow-up"></i> Solicitar Material</a>
            </div>
        </div>
        {% endif %}

        {% if service.id == 'rh' %}
        <div class="management-actions" style="margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px;">
            <h3><i class="bi bi-people"></i> Gestão de Pessoal</h3>
            
            <div class="action-buttons">
                <a href="{{ url_for('admin.admin_users') }}" class="action-btn"><i class="bi bi-person-lines-fill"></i> Gerenciar Usuários (Completo)</a>
                <a href="{{ url_for('hr.rh_ex_employees') }}" class="action-btn"><i class="bi bi-archive"></i> Ex-Funcionários</a>
                <a href="{{ url_for('hr.rh_timesheet') }}" class="action-btn"><i class="bi bi-clock-history"></i> Relatórios de Ponto</a>
            </div>
        </div>
        {% endif %}

        {% if service.id == 'financeiro' %}
        <div class="management-actions" style="margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px;">
            <h3><i class="bi bi-cash-stack"></i> Gestão Financeira</h3>
            <div class="action-buttons">
                {% if service.actions %}
                    {% for action in service.actions %}
                    {% if action.url == 'finance_commission' %}
                        {% if session.get('role') in ['admin', 'gerente', 'financeiro'] or 'comissao' in session.get('permissions', []) %}
                        <a href="{{ url_for(action.url) }}" class="action-btn"><i class="{{ action.icon }}"></i> {{ action.name }}</a>
                        {% endif %}
                    {% else %}
                    <a href="{{ url_for(action.url) }}" class="action-btn"><i class="{{ action.icon }}"></i> {{ action.name }}</a>
                    {% endif %}
                    {% endfor %}
                {% endif %}
                <button class="action-btn" style="background-color: #6c757d; cursor: not-allowed;" disabled><i class="bi bi-cash"></i> Fluxo de Caixa (Em Breve)</button>
                <a href="{{ url_for('accounts_payable') }}" class="action-btn"><i class="bi bi-receipt"></i> Contas a Pagar</a>
            </div>
        </div>
        {% endif %}

        <!-- Outras Funcionalidades -->
        <div class="placeholder-actions">
            {% if service.id == 'cozinha' %}
                <a href="{{ url_for('kitchen_portion') }}" class="action-btn" style="background-color: #d35400; color: white;"><i class="bi bi-pie-chart"></i> Porcionar Item</a>
                <a href="{{ url_for('kitchen_reports') }}" class="action-btn" style="background-color: #8e44ad; color: white;"><i class="bi bi-file-text"></i> Relatórios de Porcionamento</a>
                {% if session.get('role') == 'admin' %}
                <a href="{{ url_for('kitchen_portion_settings') }}" class="action-btn" style="background-color: #7f8c8d; color: white;"><i class="bi bi-gear"></i> Categorias Porcionáveis</a>
                {% endif %}
            {% endif %}

            {% if service.id == 'manutencao' %}
                <a href="{{ url_for('maintenance.new_maintenance_request') }}" class="action-btn"><i class="bi bi-plus-circle"></i> Nova Solicitação</a>
            {% endif %}

            {% if service.id == 'conferencias' %}
                <a href="{{ url_for('stock.new_conference') }}" class="action-btn"><i class="bi bi-plus-circle"></i> Nova Conferência</a>
                <a href="{{ url_for('stock.conference_history') }}" class="action-btn"><i class="bi bi-clock-history"></i> Histórico</a>
                <a href="{{ url_for('stock.conference_skipped_list') }}" class="action-btn"><i class="bi bi-slash-circle"></i> Itens Ignorados</a>
            {% endif %}

            {% if service.id == 'entretenimento' %}
                <a href="{{ url_for('entertainment_control') }}" class="action-btn"><i class="bi bi-music-note-beamed"></i> Sistema de Som</a>
                <a href="{{ url_for('entertainment_roku_tvs') }}" class="action-btn"><i class="bi bi-tv"></i> TVs Roku / Publicidade</a>
            {% endif %}

            {% if service.id == 'principal' %}
                <!-- Botões de logística removidos daqui -->
            {% endif %}

            {% if service.actions and service.id != 'financeiro' %}
                {% for action in service.actions %}
                <a href="{{ url_for(action.url) }}" class="action-btn"><i class="{{ action.icon }}"></i> {{ action.name }}</a>
                {% endfor %}
            {% endif %}

            {% if is_manager %}
            {% if service.id == 'manutencao' %}
            <a href="{{ url_for('maintenance.maintenance_requests_view') }}" class="action-btn"><i class="bi bi-list-check"></i> Gerenciar Solicitações</a>
            {% endif %}
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
