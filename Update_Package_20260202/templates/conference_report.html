{% extends 'base.html' %}

{% block title %}Relat√≥rio de Confer√™ncia - Back of the House{% endblock %}

{% block content %}
<div class="report-page">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>üìÑ Relat√≥rio de Confer√™ncia #{{ conference.id }}</h2>
        <a href="{{ url_for('stock.conference_history') }}" class="action-btn" style="background-color: #95a5a6; text-decoration: none;">‚Üê Voltar</a>
    </div>

    <div class="card" style="margin-bottom: 20px;">
        <h3>Detalhes</h3>
        <p><strong>Departamento:</strong> {{ conference.department }}</p>
        <p><strong>Respons√°vel:</strong> {{ conference.created_by }}</p>
        <p><strong>Data de Cria√ß√£o:</strong> {{ conference.created_at }}</p>
        <p><strong>Data de Finaliza√ß√£o:</strong> {{ conference.finished_at }}</p>
        <p><strong>Per√≠odo de Refer√™ncia:</strong> {{ conference.reference_period }}</p>
    </div>

    <div class="card" style="margin-bottom: 20px;">
        <h3 style="color: #c0392b;">üìâ Discrep√¢ncias e Perdas</h3>
        <p>Total de Perdas Financeiras: <strong style="color: #c0392b; font-size: 1.2em;">R$ {{ "%.2f"|format(conference.total_loss_value|default(0)) }}</strong></p>
        
        {% if conference.discrepancies %}
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Produto</th>
                    <th>Qtd Sistema</th>
                    <th>Qtd Contada</th>
                    <th>Diferen√ßa</th>
                    <th>Pre√ßo Unit.</th>
                    <th>Valor Total</th>
                </tr>
            </thead>
            <tbody>
                {% for disc in conference.discrepancies %}
                <tr>
                    <td>{{ disc.product_name }}</td>
                    <td>{{ disc.system_qty }} {{ disc.unit | abbreviate_unit }}</td>
                    <td>{{ disc.counted_qty }} {{ disc.unit | abbreviate_unit }}</td>
                    <td class="{{ 'text-danger' if disc.difference < 0 else 'text-success' }}" style="font-weight: bold;">
                        {{ "%.2f"|format(disc.difference) }}
                    </td>
                    <td>R$ {{ "%.2f"|format(disc.price) }}</td>
                    <td class="{{ 'text-danger' if disc.value < 0 else 'text-success' }}" style="font-weight: bold;">
                        R$ {{ "%.2f"|format(disc.value) }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>Nenhuma discrep√¢ncia encontrada.</p>
        {% endif %}
    </div>

    <div class="card">
        <h3 style="color: #f39c12;">‚ö†Ô∏è Itens N√£o Conferidos</h3>
        <p>Os seguintes itens estavam na lista mas n√£o tiveram contagem informada:</p>
        
        {% if conference.uncounted_items %}
        <ul style="list-style-type: none; padding: 0;">
            {% for item in conference.uncounted_items %}
            <li style="padding: 10px; border-bottom: 1px solid #eee;">
                <strong>{{ item.product_name }}</strong> (Sistema: {{ item.system_qty }} {{ item.unit }})
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>Todos os itens foram conferidos.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
