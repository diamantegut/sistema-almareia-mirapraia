# Plano de Configuração de Domínios Externos Ngrok

Este plano detalha a implementação de múltiplos domínios ngrok para isolamento de funções, configuração de roteamento inteligente e criação de ferramentas de automação.

## 1. Implementação de Rotas Públicas Faltantes
Como as rotas para Pré-Checkin e Pesquisa ainda não estão totalmente integradas, irei:
- **Criar Blueprint `guest`**: Centralizar rotas públicas para hóspedes.
- **Pré-Checkin**:
    - Implementar `GET /pre-checkin/<token>` para validar o link e exibir o formulário.
    - Implementar `POST /api/pre-checkin/submit` para salvar os dados no `GuestManager`.
- **Pesquisa de Satisfação**:
    - Implementar `GET /pesquisa` para exibir a pesquisa pública.
    - Implementar `POST /pesquisa` para registrar as respostas.

## 2. Roteamento Inteligente e Isolamento de Domínios
Atualizarei a lógica no [app.py](file:///f:\Sistema Almareia Mirapraia\app.py) para identificar o domínio de origem e restringir o acesso:
- **checkinalmareia.ngrok.app** → Acesso exclusivo a `/pre-checkin/*`.
- **pesquisa.almareia.ngrok.app** → Acesso exclusivo a `/pesquisa`.
- **mirapraiawhatts.ngrok.app** → Acesso exclusivo ao webhook do WhatsApp `/webhook/whatsapp`.
- **fila.mirapraia.ngrok.app** → Acesso exclusivo à fila `/fila`.
- **menu.mirapraia.ngrok.app** → Acesso exclusivo ao cardápio `/cardapio`.
- **almareia.mirapraia.ngrok.app** → Acesso completo ao sistema (Login de funcionários).

## 3. Automação do Ngrok
Criarei um sistema de gerenciamento de túneis:
- **`data/ngrok_config.json`**: Arquivo de configuração mapeando domínios, portas (5000/5001) e funções.
- **`scripts/manage_ngrok.py`**: Script Python para:
    - Validar se a porta local está ativa.
    - Iniciar todos os túneis simultaneamente usando a biblioteca `pyngrok`.
    - Registrar logs de status e erros de conexão.
- **`start_ngrok_tunnels.bat`**: Script executável para inicialização rápida.

## 4. Validação e Monitoramento
- **Health Checks**: Adição de endpoints de verificação para cada domínio.
- **Painel Administrativo**: Visualização no sistema do status de cada túnel externo.
- **Logs de Acesso**: Registro detalhado de acessos externos diferenciados por domínio para auditoria.

Deseja que eu proceda com a implementação destas etapas?