Aqui está o plano detalhado para a reestruturação completa do sistema **Sistema Almareia Mirapraia**, visando transformar a arquitetura monolítica atual em uma arquitetura modular, escalável e de fácil manutenção.

Este plano segue rigorosamente as 6 etapas solicitadas.

### 1. Análise e Auditoria do Código Atual
**Objetivo:** Mapear a dívida técnica e identificar pontos críticos antes de mover qualquer arquivo.

*   **Varredura de `app.py` (18k+ linhas):** Identificar agrupamentos lógicos de rotas (Auth, Recepção, Restaurante, Financeiro, Estoque) para extração em Blueprints.
*   **Mapeamento de Dependências:** Verificar `requirements.txt` contra os imports reais para remover bibliotecas não utilizadas.
*   **Identificação de Código Morto:** Listar scripts na raiz (`.bat`, `.ps1`, `.py`) e pastas de backup antigas (ex: `Update_Package_20260202`) para arquivamento ou exclusão.
*   **Relatório Inicial:** Gerar um arquivo `AUDIT_REPORT.md` listando arquivos duplicados, serviços dispersos (raiz vs `services/`) e inconsistências de nomenclatura.

### 2. Reorganização Estrutural dos Arquivos
**Objetivo:** Implementar uma arquitetura modular baseada no padrão "Application Factory" do Flask.

*   **Nova Hierarquia de Diretórios:**
    ```text
    /
    ├── app/                    # Núcleo da Aplicação
    │   ├── __init__.py         # Application Factory
    │   ├── blueprints/         # Módulos de Rotas (ex: auth, reception, restaurant)
    │   ├── services/           # Regras de Negócio (unificar raiz e /services)
    │   ├── models/             # Modelos de Dados (SQLAlchemy e Schemas JSON)
    │   ├── utils/              # Funções auxiliares e decorators
    │   ├── templates/          # Movido da raiz
    │   └── static/             # Movido da raiz
    ├── config/                 # Configurações do sistema
    ├── data/                   # Arquivos de dados (JSON/SQLite) - Mantido para compatibilidade
    ├── tests/                  # Testes automatizados
    ├── docs/                   # Documentação
    ├── scripts/                # Scripts de manutenção/deploy
    └── run.py                  # Novo ponto de entrada leve (substitui o app.py gordo)
    ```
*   **Ações Imediatas:**
    1.  Criar a estrutura de pastas `app/`.
    2.  Mover `templates` e `static` para dentro de `app/`.
    3.  Centralizar todos os `*_service.py` e `*_manager.py` da raiz para `app/services/`.
    4.  Mover `models.py` e `database.py` para `app/models/`.

### 3. Refatoração e Otimização
**Objetivo:** Reduzir o acoplamento e o tamanho dos arquivos.

*   **Modularização do `app.py`:**
    *   Extrair rotas para arquivos dedicados em `app/blueprints/` (ex: `auth_routes.py`, `finance_routes.py`).
    *   Substituir a instância global `app` por Blueprints registrados na factory.
*   **Unificação de Serviços:**
    *   Resolver duplicidades entre serviços antigos na raiz e novos em `services/`.
    *   Padronizar a injeção de dependências e imports.
*   **Tratamento de Erros:** Implementar handlers de erro globais no `__init__.py` para capturar exceções de forma consistente.

### 4. Documentação Técnica Completa
**Objetivo:** Garantir que o sistema seja compreensível por novos desenvolvedores.

*   **Docstrings:** Adicionar documentação padrão Google Style em todas as funções públicas dos novos serviços.
*   **README.md Atualizado:** Instruções claras de instalação, estrutura de pastas e como rodar o servidor de desenvolvimento.
*   **API Docs:** Mapear os principais endpoints REST em um arquivo `API_REFERENCE.md` (ou Swagger se aplicável).
*   **Diagrama de Arquitetura:** Criar um diagrama textual (Mermaid) no README explicando o fluxo de dados.

### 5. Testes e Validação
**Objetivo:** Garantir que a reestruturação não quebre funcionalidades existentes.

*   **Correção de Testes:** Atualizar os imports na pasta `tests/` para refletir a nova estrutura (ex: `from app.services...` em vez de `from services...`).
*   **Execução da Suíte:** Rodar todos os testes existentes (`pytest`) e garantir aprovação (Green).
*   **Novos Testes:** Criar testes unitários para a nova `Application Factory` e carregamento de configurações.

### 6. Entregáveis Finais
*   Código fonte reorganizado na pasta `app/`.
*   Arquivo `run.py` limpo e funcional.
*   Relatório `REFACTORING_LOG.md` detalhando as mudanças.
*   Suíte de testes passando 100%.

---
**Observação Importante:** Dado o tamanho do `app.py` (18k linhas), esta refatoração será feita em passos incrementais para manter o sistema funcional entre as etapas. Começaremos pela estrutura de pastas e depois moveremos módulo por módulo.
