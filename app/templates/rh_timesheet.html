{% extends 'base.html' %}

{% block title %}Relatório de Ponto - Back of the House{% endblock %}

{% block content %}
<div class="service-container">
    <div class="header-section">
        <h1><i class="bi bi-clock-history"></i> Relatório de Ponto</h1>
        <p>Acompanhamento de horas trabalhadas e banco de horas.</p>
    </div>

    <div style="margin-bottom: 20px;">
        <a href="{{ url_for('main.index') }}" class="action-btn" style="background-color: #95a5a6; text-decoration: none;"><i class="bi bi-arrow-left"></i> Voltar</a>
    </div>

    <div class="card" style="margin-bottom: 20px;">
        <form method="GET" action="{{ url_for('hr.rh_timesheet') }}" style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
            <div class="form-group" style="margin-bottom: 0; min-width: 250px;">
                <label>Funcionário:</label>
                <select name="username" class="form-control" onchange="this.form.submit()">
                    <option value="">Selecione um funcionário...</option>
                    {% for u in users %}
                    <option value="{{ u.username }}" {% if selected_user == u.username %}selected{% endif %}>{{ u.full_name }} ({{ u.username }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <label>Mês:</label>
                <input type="month" name="month" class="form-control" value="{{ selected_month }}" onchange="this.form.submit()">
            </div>
            <button type="submit" class="action-btn" style="background-color: #1e3a8a; margin-bottom: 0;"><i class="bi bi-filter"></i> Filtrar</button>
        </form>
    </div>

    {% if selected_user and report_data %}
    <div class="card">
        <h3>Folha de Ponto: {{ selected_user_name }} - {{ selected_month_display }}</h3>
        
        <div style="display: flex; gap: 20px; margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; flex-wrap: wrap;">
            <div>Total Trabalhado: <strong>{{ total_worked }}</strong></div>
            <div>Meta Total: <strong>{{ total_target }}</strong></div>
            <div>Saldo do Mês: <strong class="{{ 'text-success' if balance_seconds >= 0 else 'text-danger' }}">{{ total_balance }}</strong></div>
            <div>Banco Geral: <strong class="{{ 'text-success' if bank_seconds >= 0 else 'text-danger' }}">{{ bank_total }}</strong></div>
        </div>

        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Dia da Semana</th>
                    <th>Status</th>
                    <th>Entrada</th>
                    <th>Saída</th>
                    <th>Trabalhado</th>
                    <th>Meta</th>
                    <th>Saldo</th>
                </tr>
            </thead>
            <tbody>
                {% for day in report_data %}
                <tr {% if day.is_day_off %}style="background-color: #f0f0f0; color: #7f8c8d;"{% endif %}>
                    <td>{{ day.date_formatted }}</td>
                    <td>{{ day.weekday_name }}</td>
                    <td>{{ day.status }}</td>
                    <td>{{ day.first_start }}</td>
                    <td>{{ day.last_end }}</td>
                    <td>{{ day.worked_hms }}</td>
                    <td>{{ day.target_hms }}</td>
                    <td class="{{ 'text-success' if day.balance_seconds >= 0 else 'text-danger' }}">{{ day.balance_hms }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% elif selected_user %}
    <div class="card" style="text-align: center; color: #7f8c8d; padding: 40px;">
        <i class="bi bi-calendar-x" style="font-size: 3em; display: block; margin-bottom: 10px;"></i>
        <p>Nenhum registro encontrado para este mês.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
